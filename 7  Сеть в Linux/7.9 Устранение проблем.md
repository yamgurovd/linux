# 7.9 Устранение проблем

---

## Конспект


## Проверка состояния сетевых интерфейсов

| Команда / Понятие           | Результат / Описание                                   | Пояснение и пример использования                                           |
|----------------------------|-------------------------------------------------------|----------------------------------------------------------------------------|
| `ip link`                  | Список сетевых интерфейсов с состоянием (UP/DOWN), MAC | Проверяем, поднят ли интерфейс eth0: <br>`ip link show eth0` <br>Пример вывода: <br>`2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 ...` |
| `ip addr` / `ip a`         | Список интерфейсов с IP-адресами                      | `ip addr show wlan0` <br>Вывод с IP: <br>`inet 192.168.1.15/24 brd 192.168.1.255 scope global wlan0` |
| `ifconfig`                 | Старый инструмент со схожей информацией               | Запуск <br>`ifconfig eth0` <br>Покажет IP, состояние и статистику интерфейса |
| `dmesg | grep -i eth`      | Логи ядра по Ethernet устройствам                      | `dmesg | grep -i eth` <br>Пример: <br>`e1000e 0000:00:19.0: eth0: Intel(R) PRO/1000 Network Connection` |
| `ip route` / `ip r`        | Таблица маршрутов                                     | `ip route` <br>Пример: <br>`default via 192.168.1.1 dev eth0 proto dhcp metric 100` |
| `route -n`                 | Аналог без резолвинга DNS имен                        | `route -n` <br>Вывод: <br>`0.0.0.0 192.168.1.1 0.0.0.0 UG 100 0 0 eth0`    |

## Проверка соединения и разрешения имен

| Команда / Понятие           | Результат / Описание                                   | Пояснение и пример использования                                           |
|----------------------------|-------------------------------------------------------|----------------------------------------------------------------------------|
| `nslookup <хост>`           | IP-адрес по имени хоста                               | `nslookup ya.ru` <br>Результат: <br>`Address: 87.250.250.242`              |
| `ping <хост_или_IP>`        | Проверка доступности хоста                            | `ping -c 4 8.8.8.8` <br>4 пакета ICMP, статистика потерь и времени         |
| `arp -vn`                   | Таблица сопоставления IP и MAC в локальной сети      | `arp -vn` <br>Вывод: <br>`? (192.168.1.1) at 00:11:22:33:44:55 [ether] on eth0` |
| `traceroute -I -n <хост>`  | Трассировка маршрута через ICMP                       | `traceroute -I -n ya.ru` <br>Показывает IP промежуточных узлов (без DNS)   |
| `tracepath -n <хост>`       | Безопасная трассировка без root                       | `tracepath -n ya.ru` <br>Вывод маршрута с временем задержек                |
| `mtr <хост>`                | Интерактивное отслеживание маршрута и потерь пакетов | `mtr ya.ru` (Ctrl+C для выхода) показывает обновляющуюся таблицу пути       |

## Проверка состояния сервисов и портов

| Команда / Понятие            | Результат / Описание                                  | Пояснение и пример использования                                           |
|-----------------------------|------------------------------------------------------|----------------------------------------------------------------------------|
| `ss -tuln`                  | Список прослушиваемых TCP и UDP портов              | `ss -tuln` <br>Пример: <br>`LISTEN 0 128 0.0.0.0:80` — веб-сервер nginx слушает порт 80 |
| `netstat -tuln`             | Аналог ss                                             | Запуск `netstat -tuln` даёт похожий вывод о портах                         |
| `systemctl status <служба>` | Проверка статуса службы                               | `systemctl status nginx` <br>Информация о состоянии и журнал ошибок       |
| `systemctl restart <служба>`| Перезапуск службы                                    | `sudo systemctl restart nginx` — перезапускает nginx                      |



### Введение:

- Общий обзор: Знакомство с основами сетей, DNS, и анализ типичной проблемы соединения.

![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Problem.png)


### Проблема соединения:

![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Problem2.png)


- Сценарий: Пользователь не может подключиться к адресу, возникает ошибка таймаута соединения.
- Возможные причины: Проблемы с подключением пользователя к сети, разрешение IP, маршрутизация, неисправность сервера.

### Методы диагностики и исправления:

![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Problem3.png)


1. Физическое подключение:

![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Problem4.png)

- Проверка локального интерфейса командой ip link. Убедиться, что интерфейс поднят.
2. DNS разрешение:
- Используйте nslookup для проверки корректности IP-адреса целевого хоста.
3. Проверка связи:

![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Problem5.png)

- Используйте ping для проверки доступности целевого IP-адреса.
4. Трассировка маршрута:
- Команда traceroute для идентификации участка сети, где возникает проблема.
5. Анализ сервера-репозитория:
- Проверка состояния физического интерфейса сервера.
- Разрешение и диагностика возможных проблем с маршрутизацией.
6. Диагностика сервисных служб:

![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Problem6.png)

- Проверка служб и портов командами ss или netstat.
- В случае неработающего веб-сервера (пример: nginx), проверить и запустить необходимые службы.


---