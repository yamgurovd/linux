# 7.8 Инструменты диагностики сети


---

Конспект


### Проверка состояния сетевых интерфейсов

| Команда / Понятие           | Результат / Описание                         | Пояснение и пример использования                                                |
|----------------------------|---------------------------------------------|---------------------------------------------------------------------------------|
| `ip link`                  | Просмотр состояния интерфейсов (включен/выключен), MAC-адреса | Проверяем, активен ли интерфейс eth0: `ip link show eth0`                       |
| `ip addr` / `ip a`         | Просмотр IP-адресов интерфейсов              | Проверяем IP адреса: `ip addr show wlan0`                                      |
| `ifconfig`                 | Старый инструмент показа интерфейсов         | Запуск `ifconfig` покажет все сетевые интерфейсы с IP.                         |
| `dmesg | grep -i eth`      | Проверка записей ядра об Ethernet устройствах| `dmesg | grep -i eth` – ищем ошибки драйверов сетевых карт.                    |
| `ip route` / `ip r`        | Таблица маршрутов                            | `ip route` покажет пути, например, `default via 192.168.1.1 dev eth0`          |
| `route`                    | Альтернативный вывод таблицы маршрутов       | `route -n` – таблица маршрутов без резолвинга IP в имена хостов.              |

---

### Проверка сетевых пакетов и связности

| Команда / Понятие           | Результат / Описание                         | Пояснение и пример использования                                                |
|----------------------------|---------------------------------------------|---------------------------------------------------------------------------------|
| `ping <хост_или_IP>`       | Проверка доступности хоста                   | `ping ya.ru` — проверка доступности сайта, `ping 8.8.8.8` — напрямую DNS Google |
| `arp -vn`                  | Просмотр таблицы ARP (MAC-адреса)            | `arp -vn` покажет известные MAC-адреса в локальной сети, если ICMP блокируется  |
| `traceroute -I -n <хост>` | Отслеживает маршрут ICMP-пакетов             | `traceroute -I -n ya.ru` покажет количество прыжков и IP адреса маршрутизаторов |
| `tracepath -n <хост>`      | Аналог traceroute без необходимости root     | `tracepath -n ya.ru` — полезно, если нет root-доступа                           |
| `mtr <хост>`               | Интерактивный просмотр пути и потерь пакетов | `mtr ya.ru` показывает непрерывный маршрут и время отклика                      |

---

### Диагностика DNS

| Команда / Понятие                     | Результат / Описание                                | Пояснение и пример использования                                                              |
|--------------------------------------|----------------------------------------------------|------------------------------------------------------------------------------------------------|
| `host <хост>`                       | Простая проверка разрешения имени в IP              | `host ya.ru` выведет IP адреса сайта и DNS-сервер, который ответил                            |
| `dig <хост> [тип_записи]`          | Гибкий запрос DNS с выводом детальной информации    | `dig ya.ru A` покажет IPv4 адреса, `dig ya.ru AAAA` — IPv6                                   |
| `nslookup <хост>`                   | Стандартный запрос к DNS серверу                      | `nslookup ya.ru` – проверяет IP и DNS-сервер                                                 |
| `nmcli connection show eth0 | grep dns` | Проверка DNS-серверов, назначенных для интерфейса   | `nmcli connection show eth0 | grep dns` покажет DNS, привязанный к eth0                        |
| `systemd-resolve --status`          | Статус резолвинга DNS через systemd                   | `systemd-resolve --status` — детальный вывод текущих DNS-серверов и настроек                |

---

### Проверка портов и протоколов

| Команда / Понятие           | Результат / Описание                                   | Пояснение и пример использования                                                  |
|----------------------------|-------------------------------------------------------|-----------------------------------------------------------------------------------|
| `ss -tupn`                 | Просмотр открытых TCP/UDP соединений с процессами     | `ss -tupn` — показываются IP-адреса, порты и PID процессов                       |
| `netstat -tulpn`           | Альтернативный просмотр прослушиваемых портов         | `netstat -tulpn | grep :22` фильтрует SSH соединения                            |
| `lsof -i -P -n`            | Список процессов, использующих сетевые подключения     | `lsof -i -P -n | grep LISTEN` — кто слушает порты                                  |
| `telnet <host> <port>`     | Проверка открытости TCP порта                           | `telnet db01 3306` проверит доступность MySQL порта                              |
| `nc -zv <host> <port>`     | Проверка доступности порта без отправки данных         | `nc -zv 192.168.1.100 80` — проверка HTTP порта                                 |
| `nmap <host> -p <порты>`   | Сканирование портов хоста                               | `nmap db01 -p 22,80,3306` — сканирование нужных портов                           |

---

### Работа с firewall и iptables

| Команда / Понятие            | Результат / Описание                                   | Пояснение и пример использования                                                        |
|-----------------------------|-------------------------------------------------------|-----------------------------------------------------------------------------------------|
| `iptables -L`               | Просмотр текущих правил iptables                        | `iptables -L` — базовый просмотр правил, без root можно использовать `sudo`             |
| `firewall-cmd --list-all`   | Просмотр текущих правил firewalld                       | `firewall-cmd --list-all` — вывод активной зоны, открытых портов                        |
| `firewall-cmd --add-port=8080/tcp --permanent` | Открытие порта 8080 TCP, перманентно               | Чтобы применить: `firewall-cmd --reload`                                                  |
| `firewall-cmd --remove-port=8080/tcp --permanent` | Закрытие порта 8080 TCP, перманентно               | И перезагрузка `firewall-cmd --reload`                                                  |



1. Проверка состояния сетевых интерфейсов:

![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Instr.png)

- IP-Link: проверка физического состояния интерфейса (включен/отключен).
- IP-Addr/IP-A: просмотр IP-адреса и маски подсети интерфейса.
- ifconfig: альтернативная команда для просмотра интерфейсов.
- LO: интерфейс обратной петли, адрес 127.0.0.1/8.
- Ethernet и WLAN интерфейсы: могут иметь разные названия в зависимости от дистрибутива.
2. Проверка сетевых пакетов:

![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Instr2.png)

- ping: отправка ICMP-запросов для проверки связности.
- ICMP: если блокирован, можно использовать arp-n для проверки на уровне MAC-адресов.
- traceroute/tracepath: определение пути пакетов через сеть.
3. Диагностика DNS:


![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Instr3.png)

- ping: проверка резолвинга имени в IP.
- host, dig, nslookup: инструменты для запроса DNS серверов.
- etc.hosts и etc.resolveconf: локальные настройки DNS.
- nmcli, systemd.resolve-status: проверка DNS в разных системах.
4. Проверка портов и протоколов:


![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Instr4.png)

- ss: команда для просмотра активных соединений.
- telnet, nc, nmap: инструменты для проверки доступности портов.
5. Работа с firewall и iptables:


![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Instr5.png)

- Проверка и настройка правил доступности портов.

---