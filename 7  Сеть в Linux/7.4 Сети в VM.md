# 7.4 Сети в VM

---
## Конспект

#### Команды и понятия для настройки сетей в VirtualBox и Linux

| Команда / Понятие                                            | Результат / Описание                                                    | Пояснение и пример использования                                                                                              |
|--------------------------------------------------------------|------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------|
| `VBoxManage list hostonlyifs`                                | Просмотр доступных host-only сетевых интерфейсов VirtualBox            | Показывает созданные VirtualBox host-only интерфейсы, например `vboxnet0`.                                                    |
| `VBoxManage hostonlyif create`                               | Создание нового host-only интерфейса                                   | Создаёт новую изолированную сеть между виртуальными машинами и хостом.                                                        |
| `VBoxManage hostonlyif ipconfig vboxnet0 --ip 192.168.56.1`  | Настройка IP-адреса для host-only интерфейса `vboxnet0`                | Настраивает IP и маску для виртуальной сети хоста в VirtualBox.                                                               |
| `VBoxManage modifyvm <VM_NAME> --nic1 nat`                   | Установка первого сетевого адаптера ВМ в режим NAT                     | Режим NAT обеспечивает доступ ВМ в интернет через хост, но скрывает ВМ от внешней сети.                                        |
| `VBoxManage modifyvm <VM_NAME> --nic2 hostonly`              | Назначение второго адаптера для ВМ в режим Host-only                   | Сеть, где ВМ общаются между собой и с хостом, без выхода в интернет.                                                          |
| `VBoxManage modifyvm <VM_NAME> --nic3 bridged`               | Присвоение третьему адаптеру Bridge mode                                | ВМ становится полноценным участником локальной сети с доступом к интернету и другим устройствам.                               |
| `VBoxManage controlvm <VM_NAME> natpf1 "guestssh,tcp,,2222,,22"` | Проброс порта с хоста на ВМ (порт 2222 на хосте → 22 в ВМ)            | Позволяет подключаться с хоста через SSH к ВМ, работающей в режиме NAT.                                                       |
| `ip a` или `ip addr`                                         | Показать все сетевые интерфейсы и IP-адреса                            | Используется для просмотра текущих сетевых интерфейсов и их конфигураций на хосте или ВМ.                                      |
| `ip link set dev <интерфейс> up`                             | Включить сетевой интерфейс                                             | Активирует указанный интерфейс, например `ip link set dev eth0 up`.                                                           |
| `ip link set dev <интерфейс> down`                           | Отключить сетевой интерфейс                                            | Деактивирует интерфейс, например `ip link set dev eth0 down`.                                                                  |
| `ping <ip_адрес>`                                            | Проверка доступности хоста по сети                                    | Отправляет ICMP-запросы, например: `ping 192.168.56.101` для проверки связи с ВМ.                                            |
| `traceroute <ip_адрес>`                                      | Проследить маршрут до хоста                                           | Позволяет увидеть через какие шлюзы идут пакеты до цели, полезно для диагностики.                                              |
| `route` или `ip route`                                       | Просмотр таблицы маршрутизации                                         | Выводит маршруты сети, важен для понимания, через какие шлюзы идет трафик.                                                    |
| `ip route add <сеть> via <шлюз>`                            | Добавить статический маршрут                                           | Настраивает новый маршрут к подсети через указанный шлюз, например: `ip route add 192.168.56.0/24 via 192.168.1.1`             |
| `ifconfig vboxnet0`                                           | Просмотр настроек VirtualBox host-only интерфейса                      | Позволяет увидеть IP и статус интерфейса `vboxnet0`.                                                                            |
| `systemctl restart network`                                  | Перезапуск сетевой службы на хосте                                    | Иногда нужен после изменений в конфигурации сети для их применения.                                                            |
| `iptables -t nat -L -n -v`                                   | Просмотр правил NAT в firewall                                         | Для диагностики переадресации портов и трансляции адресов.                                                                     |
| NAT (Network Address Translation)                           | Режим подключения ВМ через хост                                        | Виртуальная машина может выходить в интернет, но сама скрыта за IP хоста.                                                     |
| Host-only Network                                           | Изолированная сеть между хостом и ВМ                                   | ВМ общаются между собой и с хостом без доступа в интернет.                                                                     |
| Bridge Network                                              | ВМ становятся видимы как полноценные устройства внутри локальной сети | ВМ получают IP из общей сети, могут взаимодействовать с другими узлами ЛВС и выходить в интернет напрямую.                    |
| `VBoxManage list vif`                                       | Просмотр всех виртуальных интерфейсов VirtualBox                      | Показывает все сетевые интерфейсы ВМ, их типы и состояние.                                                                     |
| `VBoxManage showvminfo <VM_NAME>`                            | Показать подробную информацию о настройках ВМ                        | Помогает проверить конфигурацию сети VM (режимы адаптеров, MAC-адреса и др.)                                                  |
| `VBoxManage controlvm <VM_NAME> setlinkstate1 off/on`         | Отключить/включить сетевой адаптер 1 ВМ                              | Быстрая деактивация или активация сетевого адаптера без выключения ВМ.                                                        |
| `nmcli device status`                                       | Проверка состояния сетевых устройств в NetworkManager                 | Полезно на современных дистрибутивах Linux для контроля интерфейсов.                                                          |


1. Введение

![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm.png)


- Основы сетевых настроек в VirtualBox.
![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm2.png)
- Сложности у студентов: понимание разных сетей в VirtualBox, настройка сетевых адаптеров, сохранение настроек после перезагрузки.
![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm3.png)
2. Основы сетевых интерфейсов

![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm4.png)
![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm6.png)
![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm7.png)

- Компьютеры могут иметь множество сетевых интерфейсов, подключенных к разным сетям.
- Важность IP-адресов для сетевых подключений.
3. Настройки сети в VirtualBox


![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm8.png)
![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm9.png)

- VirtualBox предлагает до четырёх сетевых адаптеров на виртуальную машину.
- Режимы подключения сетевых адаптеров: NAT, Bridge, Host-only и другие.
4. Режимы подключения сетевых адаптеров


![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm10.png)
![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm11.png)

- Host-only Network: Сеть, доступная только внутри хоста. Виртуальные машины могут общаться между собой и с хостом.
- NAT Network: Позволяет виртуальным машинам доступ в интернет через хост, но ограничивает прямое общение с внешним миром.
- Bridge Network: Виртуальные машины становятся полноправными участниками локальной сети, включая доступ в интернет и взаимодействие с другими устройствами.
5. Доступ в интернет

![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm12.png)
![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm13.png)

- В режиме NAT и Bridge, виртуальные машины легко получают доступ в интернет.
- В режиме Host-only для доступа в интернет требуется настройка маршрутизации на хосте или использование второго сетевого адаптера с настройкой NAT.
6. Переадресация портов
![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm14.png)
![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm15.png)

- Позволяет доступ к виртуальной машине из внешней сети, сопоставляя порты на хосте с портами на гостевой ОС.
- Применяется для доступа к службам, запущенным на виртуальных машинах, из внешнего мира.


![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm16.png)
![BPMN-схема бизнес-процесса](/7%20%20Сеть%20в%20Linux/Vm17.png)

---