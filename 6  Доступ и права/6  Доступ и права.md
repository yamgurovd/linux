# 6  Доступ и права


## Содержание блока

---

- [6.1 Введение](/6%20%20Доступ%20и%20права/6.1%20Введение.md)
- [6.2 Учетные записи](/6%20%20Доступ%20и%20права/6.2%20Учетные%20записи.md)
- [6.3 Управление пользователями](/6%20%20Доступ%20и%20права/6.3%20Управление%20пользователями.md)
- [6.4 Файлы управления доступом](/6%20%20Доступ%20и%20права/6.4%20Файлы%20управления%20доступом.md)
- [6.6 Разрешения файла](/6%20%20Доступ%20и%20права/6.6%20Разрешения%20файла.md)
- [6.6 Разрешения файла](/6%20%20Доступ%20и%20права/6.8%20SSH%20&%20SCP.md)
- [6.10 Упражнение - Пользователи и SSH](/6%20%20Доступ%20и%20права/6.10%20Упражнение%20-%20Пользователи%20и%20SSH.md)
- [6.11 Про IPTables](/6%20%20Доступ%20и%20права/6.11%20Про%20IPTables.md)
- [6.12 Настройка IPTables](/6%20%20Доступ%20и%20права/6.12%20Настройка%20IPTables.md)
- [6.13 Упражнение - IPTables](/6%20%20Доступ%20и%20права/6.13%20Упражнение%20-%20IPTables.md)


---

## Используемые команды всего блока
#### Команды которые использовались и актуальные 

| Команда                      | Результат / Описание                                               | Пояснение                                                                                          |
|------------------------------|-------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
| `cat /etc/group`             | Просмотр содержимого файла /etc/group                             | Показывает группы пользователей с их GID и списком участников группы                              |
| `cat /etc/passwd`            | Просмотр содержимого файла /etc/passwd                            | Содержит информацию о всех пользователях системы (UID, домашняя директория, shell и т.д.)         |
| `id d`                      | Показать UID, GID и группы пользователя с именем `d`             | Отображает id пользователя и его группы                                                          |
| `grep -i d /etc/passwd`      | Поиск строк с буквой `d` в /etc/passwd                            | Поиск пользователя или строк с символом `d` в файле пользователей                                 |
| `who`                        | Показать кто сейчас вошёл в систему                               | Отображает список вошедших пользователей, время и терминал                                      |
| `w`                          | Расширенная информация о вошедших пользователях                  | Показ времени входа, активности и запущенных задач пользователей                                 |
| `last`                       | История последних входов в систему                                | Показывает список последних сессий пользователей                                                |
| `su -`                       | Переключение на пользователя root с полной инициализацией среды  | Позволяет войти в систему под root (если есть пароль root)                                      |
| `su -c "whoami"`             | Выполнение команды `whoami` от имени root                         | Запуск одиночной команды под другим пользователем                                                |
| `cat /etc/sudoers`           | Просмотр содержимого файла /etc/sudoers                          | Файл с настройками sudo, определяющий кто и какие команды может выполнить с привилегиями         |
| `id username`                | Информация о пользователе `username`                              | Показывает UID, GID и группы пользователя `username`                                            |
| `getent passwd username`     | Получение информации о пользователе из системной базы            | Аналог `grep username /etc/passwd`, поддерживает системы с LDAP                                 |
| `getent group groupname`     | Информация о группе `groupname`                                   | Получение сведений о группе (GID, список пользователей)                                          |
| `groups username`            | Список групп пользователя `username`                             | Показывает все группы, к которым относится пользователь                                         |
| `whoami`                    | Показывает имя текущего пользователя                             | Полезно для проверки от имени какого пользователя выполнена команда                             |
| `users`                     | Показать всех вошедших пользователей                             | Выводит краткий список имен пользователей, которые сейчас в системе                             |
| `su - username`              | Переключение на пользователя `username`                          | Позволяет войти под другим пользователем (требует пароль или sudo)                              |
| `sudo -i`                   | Получение интерактивного root shell                              | Альтернатива входу по `su -`, но через sudo                                                     |
| `sudo command`              | Запуск команды с повышенными правами                             | Позволяет выполнять команды с правами суперпользователя, если разрешено в sudoers               |
| `visudo`                   | Безопасное редактирование файла /etc/sudoers                    | Редактирует конфигурацию sudoers с проверкой синтаксиса                                         |
| `passwd username`           | Изменение пароля пользователя `username`                         | Позволяет сменить пароль пользователя                                                           |
| `useradd username`          | Создание нового пользователя                                     | Создаёт учетную запись пользователя (не всегда настраивает домашний каталог автоматически)      |
| `usermod -aG group username`| Добавить пользователя `username` в группу `group`                | Позволяет добавить пользователя в дополнительную группу                                        |
| `userdel username`          | Удаление пользователя `username`                                | Удаляет учетную запись пользователя                                                            |
| `groupadd groupname`        | Создать новую группу                                            | Создаёт новую группу с заданным именем                                                        |
| `groupdel groupname`        | Удалить группу                                                 | Удаляет существующую группу                                                                    |



### Команды которые использовались
| Команда                                                                  | Описание и пример использования                                                                         |
|--------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| `sudo useradd andreyex`                                                  | Создание пользователя без домашнего каталога и пароля:                                                 |
|                                                                          | `sudo useradd andreyex`                                                                                 |
| `sudo useradd -m andreyex`                                               | Создание пользователя с домашним каталогом:                                                            |
|                                                                          | `sudo useradd -m andreyex`                                                                              |
| `sudo useradd -m -d /data/andreyex andreyex`                            | Создание пользователя с указанным домашним каталогом:                                                  |
|                                                                          | `sudo useradd -m -d /data/andreyex andreyex`                                                          |
| `sudo useradd -m -g developers destroyer`                               | Создание пользователя с основной группой developers:                                                  |
|                                                                          | `sudo useradd -m -g developers destroyer`                                                             |
| `sudo useradd -m -G developers,users destroyer`                         | Добавление пользователя в несколько дополнительных групп:                                             |
|                                                                          | `sudo useradd -m -G developers,users destroyer`                                                       |
| `sudo passwd andreyex`                                                   | Назначение пароля пользователю andreyex после создания учетной записи:                                 |
|                                                                          | `sudo passwd andreyex`                                                                                  |
| `sudo usermod -aG sudo andreyex`                                        | Добавление пользователя andreyex в группу sudo для админских прав:                                     |
|                                                                          | `sudo usermod -aG sudo andreyex`                                                                       |
| `sudo usermod -d /newhome/andreyex -m andreyex`                         | Перенос домашнего каталога пользователя andreyex на новое место с копированием содержимого:           |
|                                                                          | `sudo usermod -d /newhome/andreyex -m andreyex`                                                        |
| `sudo userdel -r andreyex`                                              | Удаление пользователя andreyex вместе с домашним каталогом и почтой (если указана):                     |
|                                                                          | `sudo userdel -r andreyex`                                                                              |
| `sudo groupadd developers`                                               | Создание новой группы developers:                                                                       |
|                                                                          | `sudo groupadd developers`                                                                              |
| `sudo groupmod -n devteam developers`                                  | Переименование группы developers в devteam:                                                          |
|                                                                          | `sudo groupmod -n devteam developers`                                                                   |
| `sudo groupdel devteam`                                                 | Удаление группы devteam:                                                                                |
|                                                                          | `sudo groupdel devteam`                                                                                  |
| `id andreyex`                                                           | Проверка UID, GID и групп пользователя andreyex:                                                      |
|                                                                          | `id andreyex`                                                                                             |
| `groups andreyex`                                                       | Вывод всех групп, в которых состоит пользователь andreyex:                                           |
|                                                                          | `groups andreyex`                                                                                         |
| `lastlog`                                                              | Проверка времени последнего входа всех пользователей:                                                 |
|                                                                          | `lastlog`                                                                                                |



### Команды которые использовались 
| Команда                                      | Описание и пример использования                                                                                                                             |
|----------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `sudo useradd username`                      | Создание нового пользователя с домашним каталогом по умолчанию.                                                                                              |
|                                              | Пример: `sudo useradd andreyex`                                                                                                                              |
| `sudo useradd -m -d /home/dev -s /bin/bash username` | Создание пользователя с указанием домашнего каталога и оболочки.                                                                                          |
|                                              | Пример: `sudo useradd -m -d /home/dev -s /bin/bash alena`                                                                                                    |
| `sudo passwd username`                       | Установка или изменение пароля пользователя.                                                                                                                |
|                                              | Пример: `sudo passwd andreyex`                                                                                                                              |
| `sudo usermod -aG group username`            | Добавление пользователя в дополнительные группы.                                                                                                           |
|                                              | Пример: `sudo usermod -aG developers andreyex`                                                                                                              |
| `sudo userdel -r username`                   | Удаление пользователя с удалением домашнего каталога и почты.                                                                                               |
|                                              | Пример: `sudo userdel -r andreyex`                                                                                                                          |
| `sudo groupadd groupname`                    | Создание новой группы.                                                                                                                                       |
|                                              | Пример: `sudo groupadd developers`                                                                                                                          |
| `sudo groupdel groupname`                    | Удаление группы.                                                                                                                                             |
|                                              | Пример: `sudo groupdel developers`                                                                                                                          |
| `id username`                                | Отображение UID, GID и групп пользователя.                                                                                                                  |
|                                              | Пример: `id andreyex`                                                                                                                                       |
| `groups username`                            | Показать группы, к которым принадлежит пользователь.                                                                                                       |
|                                              | Пример: `groups andreyex`                                                                                                                                    |
| `cat /etc/passwd`                            | Просмотр списка всех пользователей, включая системных.                                                                                                      |
|                                              | Пример: `cat /etc/passwd`                                                                                                                                   |
| `getent passwd`                              | Получение списка пользователей с учётом LDAP и других баз.                                                                                                 |
|                                              | Пример: `getent passwd`                                                                                                                                     |
| `compgen -u`                                 | Быстрый вывод всех имён пользователей.                                                                                                                     |
|                                              | Пример: `compgen -u`                                                                                                                                        |
| `users`                                      | Отображение имён пользователей, которые в данный момент вошли в систему.                                                                                    |
|                                              | Пример: `users`                                                                                                                                             |
| `who`                                        | Список пользователей, вошедших в систему с детальной информацией.                                                                                          |
|                                              | Пример: `who`                                                                                                                                               |
| `last`                                       | История входов пользователей системы.                                                                                                                     |
|                                              | Пример: `last`                                                                                                                                              |
| `sudo vipw`                                  | Безопасное редактирование файла `/etc/passwd`.                                                                                                            |
| `sudo vipw -s`                               | Безопасное редактирование файла `/etc/shadow`.                                                                                                           |
| `sudo vigr`                                  | Безопасное редактирование файла `/etc/group`.                                                                                                            |
| `sudo vigr -s`                               | Безопасное редактирование файла `/etc/gshadow`.                                                                                                         |
| `cat /etc/shadow`                            | Просмотр хэшированных паролей (требует root).                                                                                                            |
|                                              | Пример: `sudo cat /etc/shadow`                                                                                                                            |
| `cat /etc/group`                             | Просмотр групп пользователей.                                                                                                                             |
|                                              | Пример: `cat /etc/group`                                                                                                                                   |
| `cat /etc/gshadow`                           | Просмотр защищённых данных групп (пароли, администраторы).                                                                                                |
|                                              | Пример: `sudo cat /etc/gshadow`                                                                                                                           |
| `chage -l username`                          | Просмотр информации о сроках изменения пароля пользователя.                                                                                               |
|                                              | Пример: `chage -l andreyex`                                                                                                                               |
| `passwd -S username`                          | Проверка состояния пароля пользователя.                                                                                                                  |
|                                              | Пример: `passwd -S andreyex`                                                                                                                              |
| `usermod --expiredate YYYY-MM-DD username`  | Установка даты истечения срока действия учетной записи пользователя.                                                                                      |
|                                              | Пример: `sudo usermod --expiredate 2026-01-01 andreyex`                                                                                                   |
| `chmod 640 /etc/shadow`                       | Правильные права доступа для файла `/etc/shadow` для безопасности.                                                                                        |
| `ls -l /etc/passwd /etc/shadow /etc/group /etc/gshadow` | Проверка прав доступа к основным файлам управления доступом.                                                                                    |



### Команды по управлению разрешениями и владельцами файлов и каталогов в Linux

| Команда                          | Описание и пример использования                                                                                       |
|---------------------------------|----------------------------------------------------------------------------------------------------------------------|
| `ls -l /root/nginx.sh`           | Просмотр подробных прав доступа и информации о файле `/root/nginx.sh`.                                              |
| `ls -l /home/d/ | grep tmp`      | Просмотр файлов из каталога `/home/d/`, фильтрация по имени `tmp`.                                                   |
| `chmod u+rwx tmp`                | Добавить владельцу (`u`) права чтения, записи и выполнения для файла/папки `tmp`.                                     |
| `chmod ugo+r-x tmp`              | Всем пользователям (u - владелец, g - группа, o - остальные) добавить права чтения и выполнения, убрать запись.       |
| `chmod o+rwx tmp`                | Для остальных пользователей добавить полный доступ (чтение, запись, выполнение) к файлу/папке `tmp`.                  |
| `chmod o+rwx,g+r-x,o-rwx tmp`    | Сложная комбинация изменения прав: у остальных разрешить rwx, у группы добавить r-x, затем у остальных убрать rwx.     |
| `chmod -R a+rwx /mydir`          | Рекурсивно дать всем полный доступ (`rwx`) ко всему содержимому каталога `/mydir`.                                  |
| `chmod 777 temp`                 | Полный доступ (rwx) владельцу, группе и остальным для файла/папки `temp`.                                           |
| `chmod 555 temp`                 | Дать права только на чтение и выполнение (r-x) всем пользователям (владелец, группа, остальные).                     |
| `chmod 660 temp`                 | Владелец и группа получают права чтения и записи (rw-), остальные — без прав.                                       |
| `chmod 750 temp`                 | Владелец — полный доступ rwx, группа — чтение и выполнение r-x, остальные — без прав.                               |
| `chown d:developer temp`         | Сменить владельца файла/папки `temp` на пользователя `d` и группу на `developer`.                                   |
| `chown d temp`                  | Сменить владельца файла/папки `temp` на пользователя `d`, без изменения группы.                                    |
| `chgrp devops temp`              | Изменить группу файла/папки `temp` на `devops`.                                                                    |
| `stat tmp`                     | Посмотреть расширенную информацию о файле `tmp` (включая права, владельца, дату изменения).                         |
| `getfacl tmp`                  | Просмотр расширенных прав доступа (ACL) файла `tmp`.                                                                |
| `setfacl -m u:andreyex:rwx tmp`| Добавить пользователю `andreyex` права чтения, записи и выполнения на файл `tmp` через ACL.                         |
| `grep ^d /etc/passwd`           | Вывести строки из `/etc/passwd`, начинающиеся с `d` (используется для фильтрации/проверки).                         |

---

### Исправления и уточнения твоих команд

| Команда                        | Описание и пример                                                                                            |
|-------------------------------|-------------------------------------------------------------------------------------------------------------|
| `chmod u+rwzx tmp`             | Ошибка: нет права `z`. Правильный вариант: `chmod u+rwx tmp`                                                |
| `chmod u+rwx tmp`              | Добавить владельцу права чтения, записи, выполнения (rwx) для файла/папки `tmp`.                              |
| `chmod ugo+r-x tmp`            | Добавить всем (u – владелец, g – группа, o – остальные) права чтения и выполнения, убрать права записи.      |
| `chmod o+rwx tmp`              | Добавить другим (others) права чтения, записи, выполнения.                                                  |
| `chmod o+rwx,g+r-x,o-rwx tmp`  | Противоречивая команда: добавляет и убирает права у остальных и группы, итог зависит от порядка.             |
| `chmod -R a+rwx /mydir`        | Рекурсивно дать полный доступ (rwx) всем в каталоге `/mydir`.                                              |
| `chmod 777 temp`               | Полный доступ всем (rwx) владельцу, группе и остальным.                                                    |
| `chmod 555 temp`               | Доступ только на чтение и выполнение для всех (r-x).                                                      |
| `chmod 660 temp`               | Владелец и группа: rw-, остальные – без прав (---).                                                       |
| `chmod 750 temp`               | Владелец: rwx, группа: r-x, остальные: ---                                                               |
| `chown d:developer temp`       | Сменить владельца на `d` и группу на `developer`.                                                        |
| `chown d temp`                | Сменить только владельца на `d`.                                                                          |
| `chgrp devops temp`            | Сменить группу на `devops`.                                                                                |



### Популярные команды 

| Команда                            | Описание и пример использования                                                                                           |
|-----------------------------------|----------------------------------------------------------------------------------------------------------------------------|
| `ssh user@hostname`                | Подключение к удаленному серверу под пользователем `user`.<br>Пример: `ssh max@devstr01` — подключиться к серверу `devstr01` как пользователь `max`.|
| `ssh hostname`                    | Подключение к серверу `hostname` под текущим пользователем системы.<br>Пример: `ssh devstr01` — подключиться к `devstr01` без указания пользователя.   |
| `ssh-keygen`                     | Генерация пары SSH-ключей (публичного и приватного).<br>Пример: просто ввести `ssh-keygen` в терминале и следовать инструкциям.                          |
| `ssh-copy-id user@hostname`      | Копирование публичного ключа на сервер для беспарольной аутентификации.<br>Пример: `ssh-copy-id max@devstr01` — добавить ключ пользователя `max` на сервер.|
| `scp /path/to/local/file user@hostname:/remote/path` | Копирование файла с локальной машины на удаленный сервер.<br>Пример: `scp ~/file.txt max@devstr01:/home/max/` — скопировать файл `file.txt` на сервер.          |
| `scp user@hostname:/remote/path/file /local/path` | Копирование файла с удаленного сервера на локальную машину.<br>Пример: `scp max@devstr01:/home/max/file.txt ~/` — скопировать файл на локальный компьютер.           |
| `scp -r /local/directory user@hostname:/remote/path` | Рекурсивное копирование каталога на удаленный сервер.<br>Пример: `scp -r ~/mydir max@devstr01:/home/max/` — скопировать каталог `mydir` на сервер.               |
| `scp -p /path/to/file user@hostname:/remote/path` | Копирование файла с сохранением атрибутов (времени создания, прав).<br>Пример: `scp -p ~/script.sh max@devstr01:/home/max/` — копирование с сохранением атрибутов.    |
| `ssh -p port user@hostname`      | Подключение к удаленному серверу на нестандартном SSH-порту.<br>Пример: `ssh -p 2222 max@devstr01` — подключиться на порт `2222`.                            |

### Команды которые использовались
| Команда                                      | Описание и пример использования                                                                                                                             |
|----------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `id`                                         | Отображение UID, GID и групп пользователя.                                                                                                                  |
|                                              | Пример: `id`                                                                                                                                                |
| `cat /etc/passwd \| grep 1001`                | Поиск в файле `/etc/passwd` строки, содержащей UID или GID 1001.                                                                                            |
|                                              | Пример: `cat /etc/passwd \| grep 1001`                                                                                                                     |
| `sudo grep %sudo /etc/sudoers`                | Просмотр строк, связанных с группой sudo, в файле sudoers для настройки sudo прав.                                                                          |
|                                              | Пример: `sudo grep %sudo /etc/sudoers`                                                                                                                    |
| `sudo useradd diego`                          | Создание нового пользователя с именем diego.                                                                                                               |
|                                              | Пример: `sudo useradd diego`                                                                                                                               |
| `sudo passwd diego`                           | Установка или изменение пароля для пользователя diego.                                                                                                     |
|                                              | Пример: `sudo passwd diego`                                                                                                                                |
| `ls -al /home/d/tmp`                          | Просмотр подробного списка содержимого каталога /home/d/tmp.                                                                                              |
|                                              | Пример: `ls -al /home/d/tmp`                                                                                                                               |
| `chmod go-w /home/d/tmp`                      | Удаление права на запись для групп и остальных пользователей в каталоге /home/d/tmp.                                                                        |
|                                              | Пример: `chmod go-w /home/d/tmp`                                                                                                                           |
| `chmod g+w, o-rwx /home/d/tmp`                | Добавление права на запись для группы и удаление всех прав для остальных пользователей в каталоге /home/d/tmp.                                              |
|                                              | Пример: `chmod g+w, o-rwx /home/d/tmp`                                                                                                                     |
| `sudo chown pollme /home/d/tmp`                | Смена владельца каталога /home/d/tmp на пользователя pollme.                                                                                               |
|                                              | Пример: `sudo chown pollme /home/d/tmp`                                                                                                                    |
| `sudo chown -R pollme /home/d/tmp`             | Рекурсивная смена владельца каталога /home/d/tmp и его содержимого на пользователя pollme.                                                                 |
|                                              | Пример: `sudo chown -R pollme /home/d/tmp`                                                                                                                 |
| `chmod 100 /home/d/tmp`                        | Установка прав доступа на 100 (исполнение только владельцем) для каталога /home/d/tmp.                                                                     |
|                                              | Пример: `chmod 100 /home/d/tmp`                                                                                                                           |
| `chmod 755 ~/tmp`                              | Установка прав доступа 755 (чтение, запись, исполнение для владельца; чтение и исполнение для группы и остальных) для каталога tmp в домашнем каталоге.   |
|                                              | Пример: `chmod 755 ~/tmp`                                                                                                                                  |
| `sudo find /var/log -perm -g=w`                | Поиск файлов в /var/log с правом записи для группы.                                                                                                        |
|                                              | Пример: `sudo find /var/log -perm -g=w`                                                                                                                    |
| `sudo find /var/log -perm -g=w ! -perm /u=rwx` | Поиск файлов в /var/log с правом записи для группы, но без всех прав владельца (чтение, запись, исполнение).                                                |
|                                              | Пример: `sudo find /var/log -perm -g=w ! -perm /u=rwx`                                                                                                    |
| `ssh-copy-id max@s01`                          | Копирование SSH-ключа для доступа к серверу s01 пользователем max.                                                                                        |
|                                              | Пример: `ssh-copy-id max@s01`                                                                                                                             |
| `scp manifesto.tar.gz ws01:home/d/`            | Копирование файла manifesto.tar.gz на сервер ws01 в каталог home/d/.                                                                                       |
|                                              | Пример: `scp manifesto.tar.gz ws01:home/d/`                                                                                                               |


### Команды IPTables для фильтрации и управления трафиком

| Команда                                                                                                      | Описание и пример использования                                                                                                                   |
|--------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| `iptables -L`                                                                                                | Просмотр текущих правил всех цепочек таблицы filter.                                                                                              |
| `iptables -A INPUT -s 192.168.0.100 -j DROP`                                                                 | Блокировка всего входящего трафика от IP-адреса 192.168.0.100.                                                                                   |
| `iptables -A INPUT -p tcp --dport 22 -j ACCEPT`                                                               | Разрешение входящего трафика TCP на порт 22 (SSH).                                                                                                |
| `iptables -P INPUT DROP`                                                                                      | Установка политики по умолчанию для цепочки INPUT на DROP (отклонять все не разрешённые пакеты).                                                 |
| `iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080`                                  | Перенаправление входящего трафика с порта 80 на порт 8080 (NAT, проброс портов).                                                                 |
| `iptables -A INPUT -p tcp --dport 22 -m state --state NEW -m limit --limit 3/min -j ACCEPT`                     | Ограничение количества новых SSH-подключений (порт 22) до 3 в минуту.                                                                             |
| `iptables -F`                                                                                                | Очистка всех правил (флешинг таблиц).                                                                                                            |
| `iptables -X`                                                                                                | Удаление всех пользовательских цепочек.                                                                                                          |
| `iptables-save`                                                                                              | Сохранение текущих правил iptables (например, для резервного копирования).                                                                       |
| `iptables-restore`                                                                                           | Восстановление правил из сохранённого файла.                                                                                                    |
| `iptables -I INPUT 1 -p tcp --dport 17500 -s 10.0.0.85 -j ACCEPT -m comment --comment "Friendly Dropbox"`     | Вставка правила в начало цепочки INPUT, разрешающего доступ к порту 17500 только с IP 10.0.0.85 с комментарием.                                |
| `iptables -R INPUT 2 -p tcp --dport 17500 -j REJECT --reject-with icmp-port-unreachable`                      | Замена правила №2 в цепочке INPUT для отклонения доступа к порту 17500 с отправкой ICMP сообщения об ошибке.                                      |
| `iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT`                                      | Разрешение пакетов, относящихся к уже установленным и связанным соединениям.                                                                    |
| `iptables -I INPUT 1 -i lo -j ACCEPT`                                                                         | Разрешение всего трафика с loopback интерфейса (локальные соединения).                                                                           |
| `iptables -A INPUT -p tcp --dport 443 -j ACCEPT`                                                            | Разрешение входящего HTTPS-трафика на порт 443.                                                                                                 |
| `iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT`                                              | Разрешение ICMP echo request (ping) запросов.                                                                                                   |
| `iptables -A INPUT -p tcp --dport 22 -m conntrack --ctstate NEW -m limit --limit 3/min --limit-burst 3 -j ACCEPT` | Ограничение новых SSH-подключений до 3 в минуту с всплеском в 3 для защиты от DoS атак по SSH.                                                    |
| `iptables -A INPUT -p tcp --dport 22 -j DROP`                                                               | Отклонение всех остальных попыток подключения к SSH, не попавших под ограничение лимита.                                                        |
| `iptables -A INPUT -s 5.6.7.8 -j DROP`                                                                       | Бан IP-адреса 5.6.7.8 — полное блокирование трафика с данного адреса.                                                                           |
| `iptables --version`                                                                                         | Проверка установленной версии утилиты IPTables.                                                                                                 |



### Команды IPTables для настройки правил SSH и управления трафиком

| Команда                                                                                              | Описание и пример использования                                                                                                                  |
|----------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------|
| `iptables -A INPUT -p tcp -s 172.20.236.52 --dport 22 -j ACCEPT`                                    | Разрешить входящие SSH-соединения (TCP порт 22) только с компьютера WS01 с IP 172.20.236.52.                                                    |
| `iptables -A INPUT -p tcp --dport 22 -j DROP`                                                      | Запретить все остальные SSH-подключения с любых других IP, кроме разрешённых.                                                                     |
| `iptables -I OUTPUT 1 -p tcp -d 10.0.0.15 --dport 443 -j ACCEPT`                                   | Добавить правило с высоким приоритетом (в начало цепочки OUTPUT), разрешающее исходящие HTTPS-соединения с сервером на IP 10.0.0.15.              |
| `iptables -D OUTPUT 3`                                                                             | Удалить правило из цепочки OUTPUT под номером 3 (номер правила определяется командой `iptables -L --line-numbers`).                              |
| `iptables -A OUTPUT -p tcp --dport 3306 -d 172.20.10.10 -j ACCEPT`                                 | Разрешить исходящий трафик к серверу базы данных на порт 3306 (MySQL) на IP 172.20.10.10.                                                       |
| `iptables -A OUTPUT -p tcp --dport 80 -j DROP`                                                     | Заблокировать исходящие HTTP-соединения (порт 80) на все адреса (блокировать все, кроме явно разрешённых).                                       |
| `iptables -A OUTPUT -p tcp -d 93.184.216.34 --dport 80 -j ACCEPT`                                  | Разрешить исходящий HTTP-трафик на конкретный IP 93.184.216.34 (например, сервер репозитория).                                                  |
| `iptables -A INPUT -p tcp -s 172.20.10.20 --dport 3306 -j ACCEPT`                                  | Разрешить входящие подключения к базе данных (порт 3306) только от сервера приложений с IP 172.20.10.20.                                         |
| `iptables -A INPUT -p tcp --dport 3306 -j DROP`                                                   | Запретить все прочие подключения к порту 3306 (MySQL) со всех остальных IP.                                                                       |
| `iptables -L --line-numbers -v`                                                                    | Просмотр текущих правил всех цепочек с номерами правил и подробной статистикой по пакетам и байтам.                                              |
| `iptables -F`                                                                                      | Очистить все правила во всех цепочках таблицы filter.                                                                                            |
| `iptables -X`                                                                                      | Удалить все пользовательские цепочки (созданные вручную).                                                                                        |
| `iptables -P INPUT DROP`                                                                           | Установить политику по умолчанию в цепочке INPUT на DROP — отклонять все пакеты, не попавшие под правила.                                        |
| `iptables -P OUTPUT ACCEPT`                                                                        | Установить политику по умолчанию в цепочке OUTPUT на ACCEPT — разрешать все исходящие пакеты.                                                   |
| `iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT`                          | Разрешить все пакеты, относящиеся к уже установленным или связанным соединениям.                                                                  |
| `iptables -A INPUT -i lo -j ACCEPT`                                                                | Разрешить весь трафик интерфейса loopback (localhost).                                                                                          |
| `iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT`                                    | Разрешить получение ping-запросов (ICMP echo-request).                                                                                          |
| `iptables -I INPUT 1 -p tcp --dport 22 -m limit --limit 3/min --limit-burst 3 -j ACCEPT`           | Ограничение числа новых SSH-подключений до 3 в минуту с максимальным всплеском в 3 для защиты от перебора.                                        |
| `iptables -A INPUT -j LOG --log-prefix "IPTables-Dropped: " --log-level 4`                         | Логирование пакетов, которые будут отброшены, с префиксом в системный журнал (важно для диагностики и аудита).                                   |
| `iptables-save > /etc/iptables/rules.v4`                                                         | Сохранить текущие правила в файл для автоматической загрузки после перезагрузки (пример для Debian/Ubuntu).                                     |
| `iptables-restore < /etc/iptables/rules.v4`                                                      | Восстановить правила из сохранённого файла.                                                                                                    |
| `iptables -R INPUT 2 -p tcp --dport 22 -j DROP`                                                  | Заменить правило номер 2 в цепочке INPUT на отклонение подключения к SSH (порт 22).                                                             |
| `iptables -A OUTPUT -p tcp --dport 443 -j ACCEPT`                                                | Разрешить все исходящие HTTPS-соединения.                                                                                                       |




| Команда                                                                                                  | Описание и пример использования                                                                                                          |
|----------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| `sudo apt install iptables`                                                                              | Установка пакета IPTables на систему.                                                                                                  |
| `sudo iptables -L`                                                                                       | Просмотр текущих правил всех цепочек таблицы filter (без детального числового отображения).                                            |
| `sudo iptables -L -n`                                                                                    | Просмотр правил IPTables с выводом IP-адресов и портов в числовом формате (ускоряет отображение).                                       |
| `sudo iptables -L -n --line-numbers`                                                                     | Просмотр правил с нумерацией строк, что помогает идентифицировать правила для удаления или изменения.                                  |
| `sudo iptables -A INPUT -s <IP/Jumphost> -p tcp --dport 22 -j ACCEPT`                                     | Разрешение входящего SSH-трафика от JumpHost по порту 22.                                                                              |
| `sudo iptables -A INPUT -s <IP/App01> -p tcp --dport 80 -j ACCEPT`                                        | Разрешение входящего HTTP-трафика от сервера App01 по порту 80.                                                                        |
| `sudo iptables -A INPUT -j DROP`                                                                          | Запрет всех остальных входящих соединений, не попавших под разрешающие правила.                                                       |
| `sudo iptables -A OUTPUT -p tcp -d 172.20.235.10 --dport 3306 -j ACCEPT`                                  | Разрешение исходящего TCP-трафика на порт 3306 к серверу базы данных (пример IP).                                                     |
| `sudo iptables -A OUTPUT -p tcp -d <repo-server> --dport 80 -j ACCEPT`                                    | Разрешение исходящего TCP-трафика на порт 80 к серверу репозитория (указать IP или домен).                                             |
| `sudo iptables -A OUTPUT -p tcp -d google.com --dport 443 -j ACCEPT`                                      | Разрешение HTTPS-трафика к google.com для операций обновления или других нужд.                                                        |
| `sudo iptables -D INPUT 3`                                                                                | Удаление правила с номером 3 из цепочки INPUT (например, при разрешении проблем с подключениями).                                      |
| `sudo bash task-2.sh`                                                                                      | Запуск скрипта с названием task-2.sh, возможно для проверки или установки правил IPTables.                                              |
| `ssh ws01`                                                                                                | Подключение по SSH к машине WS01, для которой настраиваются правила IPTables.                                                         |
| `check_input.sh check_output.sh`                                                                           | Запуск скриптов для проверки корректности настроек входящего и исходящего трафика.                                                    |
