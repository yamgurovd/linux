# 6.4 Файлы управления доступом

---

## Конспект

### Команды которые использовались 
| Команда                                      | Описание и пример использования                                                                                                                             |
|----------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `sudo useradd username`                      | Создание нового пользователя с домашним каталогом по умолчанию.                                                                                              |
|                                              | Пример: `sudo useradd andreyex`                                                                                                                              |
| `sudo useradd -m -d /home/dev -s /bin/bash username` | Создание пользователя с указанием домашнего каталога и оболочки.                                                                                          |
|                                              | Пример: `sudo useradd -m -d /home/dev -s /bin/bash alena`                                                                                                    |
| `sudo passwd username`                       | Установка или изменение пароля пользователя.                                                                                                                |
|                                              | Пример: `sudo passwd andreyex`                                                                                                                              |
| `sudo usermod -aG group username`            | Добавление пользователя в дополнительные группы.                                                                                                           |
|                                              | Пример: `sudo usermod -aG developers andreyex`                                                                                                              |
| `sudo userdel -r username`                   | Удаление пользователя с удалением домашнего каталога и почты.                                                                                               |
|                                              | Пример: `sudo userdel -r andreyex`                                                                                                                          |
| `sudo groupadd groupname`                    | Создание новой группы.                                                                                                                                       |
|                                              | Пример: `sudo groupadd developers`                                                                                                                          |
| `sudo groupdel groupname`                    | Удаление группы.                                                                                                                                             |
|                                              | Пример: `sudo groupdel developers`                                                                                                                          |
| `id username`                                | Отображение UID, GID и групп пользователя.                                                                                                                  |
|                                              | Пример: `id andreyex`                                                                                                                                       |
| `groups username`                            | Показать группы, к которым принадлежит пользователь.                                                                                                       |
|                                              | Пример: `groups andreyex`                                                                                                                                    |
| `cat /etc/passwd`                            | Просмотр списка всех пользователей, включая системных.                                                                                                      |
|                                              | Пример: `cat /etc/passwd`                                                                                                                                   |
| `getent passwd`                              | Получение списка пользователей с учётом LDAP и других баз.                                                                                                 |
|                                              | Пример: `getent passwd`                                                                                                                                     |
| `compgen -u`                                 | Быстрый вывод всех имён пользователей.                                                                                                                     |
|                                              | Пример: `compgen -u`                                                                                                                                        |
| `users`                                      | Отображение имён пользователей, которые в данный момент вошли в систему.                                                                                    |
|                                              | Пример: `users`                                                                                                                                             |
| `who`                                        | Список пользователей, вошедших в систему с детальной информацией.                                                                                          |
|                                              | Пример: `who`                                                                                                                                               |
| `last`                                       | История входов пользователей системы.                                                                                                                     |
|                                              | Пример: `last`                                                                                                                                              |
| `sudo vipw`                                  | Безопасное редактирование файла `/etc/passwd`.                                                                                                            |
| `sudo vipw -s`                               | Безопасное редактирование файла `/etc/shadow`.                                                                                                           |
| `sudo vigr`                                  | Безопасное редактирование файла `/etc/group`.                                                                                                            |
| `sudo vigr -s`                               | Безопасное редактирование файла `/etc/gshadow`.                                                                                                         |
| `cat /etc/shadow`                            | Просмотр хэшированных паролей (требует root).                                                                                                            |
|                                              | Пример: `sudo cat /etc/shadow`                                                                                                                            |
| `cat /etc/group`                             | Просмотр групп пользователей.                                                                                                                             |
|                                              | Пример: `cat /etc/group`                                                                                                                                   |
| `cat /etc/gshadow`                           | Просмотр защищённых данных групп (пароли, администраторы).                                                                                                |
|                                              | Пример: `sudo cat /etc/gshadow`                                                                                                                           |
| `chage -l username`                          | Просмотр информации о сроках изменения пароля пользователя.                                                                                               |
|                                              | Пример: `chage -l andreyex`                                                                                                                               |
| `passwd -S username`                          | Проверка состояния пароля пользователя.                                                                                                                  |
|                                              | Пример: `passwd -S andreyex`                                                                                                                              |
| `usermod --expiredate YYYY-MM-DD username`  | Установка даты истечения срока действия учетной записи пользователя.                                                                                      |
|                                              | Пример: `sudo usermod --expiredate 2026-01-01 andreyex`                                                                                                   |
| `chmod 640 /etc/shadow`                       | Правильные права доступа для файла `/etc/shadow` для безопасности.                                                                                        |
| `ls -l /etc/passwd /etc/shadow /etc/group /etc/gshadow` | Проверка прав доступа к основным файлам управления доступом.                                                                                    |


### 1. Введение:

![BPMN-схема бизнес-процесса](/6%20%20Доступ%20и%20права/Access.png)

- Обзор аккаунтов и их управление.
- Фокус на файлах управления доступом, расположение в каталоге /etc.
- Важность использования специальных инструментов для изменений (например, vpw, vga).
### 2. Основные файлы:

![BPMN-схема бизнес-процесса](/6%20%20Доступ%20и%20права/Access2.png)

- /etc/passwd: Основная информация о пользователях (имя, UID, GID, домашний каталог, оболочка).
- /etc/shadow: Хранит хэши паролей.
- /etc/group: Информация о группах пользователей (имя группы, GID, участники).
- /etc/gshadow: Дополнительные настройки для групп.
### 3. Структура файла /etc/passwd:

![BPMN-схема бизнес-процесса](/6%20%20Доступ%20и%20права/Access3.png)

- Разделен на поля двоеточием: имя пользователя, "X" в колонке пароля (фактически хранится в /etc/shadow), UID, GID, информация GECOS (необязательная), домашний каталог, оболочка.
### 4. Структура файла /etc/shadow:
- Разделена на поля двоеточием: имя пользователя, зашифрованный пароль, дата последней смены пароля в эпохе Unix, минимальный/максимальный срок смены пароля, предупреждение о сроке действия, инактивность, окончание срока действия учетной записи.
### 5. Структура файла /etc/group:
- Разделена на поля двоеточием: имя группы, пароль (обычно "x"), GID, члены группы.
### 6. Особенности:
- Импортантно понимать функционал и структуру этих файлов для эффективного управления доступом пользователей и групп в системе Unix/Linux.
- Изменение данных файлов требует внимательности и понимания всех возможных последствий, а также использования корректных инструментов.

---